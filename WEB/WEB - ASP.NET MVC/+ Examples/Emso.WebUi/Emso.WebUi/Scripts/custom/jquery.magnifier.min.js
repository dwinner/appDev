jQuery.imageMagnify={dsettings:{magnifyby:3,duration:500,imgopacity:.2},cursorcss:"url(magnify.cur), -moz-zoom-in",zIndexcounter:100,refreshoffsets:function(n,t,i){var u=t.offset(),r={x:n.scrollLeft(),y:n.scrollTop(),w:n.width(),h:n.height()};i.attrs.x=u.left;i.attrs.y=u.top;i.newattrs.x=r.x+r.w/2-i.newattrs.w/2;i.newattrs.y=r.y+r.h/2-i.newattrs.h/2;i.newattrs.x<r.x+5?i.newattrs.x=r.x+5:i.newattrs.x+i.newattrs.w>r.x+r.w&&(i.newattrs.x=r.x+5);i.newattrs.y<r.y+5&&(i.newattrs.y=r.y+5)},magnify:function(n,t,i){var r={},u,f,e;r=jQuery.extend(r,this.dsettings,i);u=i.thumbdimensions?{w:i.thumbdimensions[0],h:i.thumbdimensions[1]}:{w:t.outerWidth(),h:t.outerHeight()};f={};f.w=r.magnifyto?r.magnifyto:Math.round(u.w*r.magnifyby);f.h=r.magnifyto?Math.round(u.h*f.w/u.w):Math.round(u.h*r.magnifyby);t.css("cursor",jQuery.imageMagnify.cursorcss);t.data("imgshell")&&(t.data("imgshell").$clone.remove(),t.css({opacity:1}).unbind("click.magnify"));e=t.clone().css({position:"absolute",left:0,top:0,visibility:"hidden",border:"1px solid gray",cursor:"pointer"}).appendTo(document.body);e.data("$relatedtarget",t);t.data("imgshell",{$clone:e,attrs:u,newattrs:f});t.bind("click.magnify",function(){var i=n(this).css({opacity:r.imgopacity}),t=i.data("imgshell"),u;jQuery.imageMagnify.refreshoffsets(n(window),i,t);u=t.$clone;u.stop().css({zIndex:++jQuery.imageMagnify.zIndexcounter,left:t.attrs.x,top:t.attrs.y,width:t.attrs.w,height:t.attrs.h,opacity:0,visibility:"visible",display:"block"}).animate({opacity:1,left:t.newattrs.x,top:t.newattrs.y,width:t.newattrs.w,height:t.newattrs.h},r.duration,function(){})});e.click(function(){var t=n(this),i=t.data("$relatedtarget").data("imgshell");jQuery.imageMagnify.refreshoffsets(n(window),t.data("$relatedtarget"),i);t.stop().animate({opacity:0,left:i.attrs.x,top:i.attrs.y,width:i.attrs.w,height:i.attrs.h},r.duration,function(){t.hide();t.data("$relatedtarget").css({opacity:1})})})}};jQuery.fn.imageMagnify=function(n){var t=jQuery;return this.each(function(){var i=t(this);return this.tagName!="IMG"?!0:(parseInt(i.css("width"))>0&&parseInt(i.css("height"))>0||n.thumbdimensions?jQuery.imageMagnify.magnify(t,i,n):this.complete?jQuery.imageMagnify.magnify(t,i,n):t(this).bind("load",function(){jQuery.imageMagnify.magnify(t,i,n)}),!0)})};jQuery.fn.applyMagnifier=function(){return this.each(function(){return this.tagName!="IMG"})};jQuery(document).ready(function(n){var i=n(".magnify"),t;i.each(function(){var t=n(this),i={};t.attr("data-magnifyto")&&(i.magnifyto=parseFloat(t.attr("data-magnifyto")));t.attr("data-magnifyby")&&(i.magnifyby=parseFloat(t.attr("data-magnifyby")));t.attr("data-magnifyduration")&&(i.duration=parseInt(t.attr("data-magnifyduration")));t.imageMagnify(i)});t=n('a[rel^="magnify["]');t.each(function(){var t=n(this),i=t.attr("rel").match(/\[.+\]/)[0].replace(/[\[\]']/g,"");t.data("magnifyimageid",i);t.click(function(t){n("#"+n(this).data("magnifyimageid")).trigger("click.magnify");t.preventDefault()})})});